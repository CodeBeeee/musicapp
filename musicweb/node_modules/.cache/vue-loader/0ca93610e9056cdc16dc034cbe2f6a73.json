{"remainingRequest":"C:\\Users\\WE\\Desktop\\毕业设计\\musicweb\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\WE\\Desktop\\毕业设计\\musicweb\\src\\components\\admin\\NewsInfo.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\WE\\Desktop\\毕业设计\\musicweb\\src\\components\\admin\\NewsInfo.vue","mtime":1580071500506},{"path":"C:\\Users\\WE\\Desktop\\毕业设计\\musicweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\WE\\Desktop\\毕业设计\\musicweb\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\WE\\Desktop\\毕业设计\\musicweb\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\WE\\Desktop\\毕业设计\\musicweb\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\r\n// 工具栏配置\r\nconst toolbarOptions = [\r\n  [\"bold\", \"italic\", \"underline\", \"strike\"], // 加粗 斜体 下划线 删除线\r\n  [\"blockquote\", \"code-block\"], // 引用  代码块\r\n  [{ header: 1 }, { header: 2 }], // 1、2 级标题\r\n  [{ list: \"ordered\" }, { list: \"bullet\" }], // 有序、无序列表\r\n  [{ script: \"sub\" }, { script: \"super\" }], // 上标/下标\r\n  [{ indent: \"-1\" }, { indent: \"+1\" }], // 缩进\r\n  // [{'direction': 'rtl'}],                         // 文本方向\r\n  [{ size: [\"small\", false, \"large\", \"huge\"] }], // 字体大小\r\n  [{ header: [1, 2, 3, 4, 5, 6, false] }], // 标题\r\n  [{ color: [] }, { background: [] }], // 字体颜色、字体背景颜色\r\n  [{ font: [] }], // 字体种类\r\n  [{ align: [] }], // 对齐方式\r\n  [\"clean\"], // 清除文本格式\r\n  [\"link\", \"image\", \"video\"] // 链接、图片、视频\r\n];\r\nimport { quillEditor } from \"vue-quill-editor\";\r\nimport \"quill/dist/quill.core.css\";\r\nimport \"quill/dist/quill.snow.css\";\r\nimport \"quill/dist/quill.bubble.css\";\r\nimport {findNewsInfo,getNewsCount,getNewsSearch,delNews} from '../../api/index';\r\nexport default {\r\n    name:\"userinfo\",\r\n    data(){\r\n        return{\r\n            formdata:{\r\n               stpage:'',\r\n               pagesize:''     \r\n            },\r\n            searchform:{\r\n               search:'',\r\n               searchvalue:''     \r\n            },\r\n            delform:{\r\n                id:''\r\n            },\r\n            form:{\r\n                newstitle:'',\r\n                newstype:'',\r\n                publishdate:'',\r\n                newscontent:'',\r\n                imgurl:''\r\n            }, \r\n            searchinput: '',\r\n            select: '',\r\n            size:10,\r\n            currentSize:0,\r\n            total:0,\r\n            tableData:[],\r\n            loading:false,\r\n            NewsdialogFormVisible:false,\r\n            EditdialogFormVisible:false,\r\n            rowData:[],\r\n            formLabelWidth: '130px',\r\n            imgurlData:[[]],\r\n            content:'',\r\n            urlData:'',\r\n            fileList:[],\r\n            quillUpdateImg:false,\r\n            fullscreenLoading:false,\r\n            editorOption: {\r\n            placeholder: \"\",\r\n            theme: \"snow\", // or 'bubble'\r\n            placeholder: \"您想说点什么？\",\r\n            modules: {\r\n            toolbar: {\r\n                container: toolbarOptions,\r\n                // container: \"#toolbar\",\r\n                handlers: {\r\n                image: function(value) {\r\n                    if (value) {\r\n                    // 触发input框选择图片文件\r\n                    document.querySelector(\".avatar-uploader input\").click();\r\n                    } else {\r\n                    this.quill.format(\"image\", false);\r\n                    }\r\n                },\r\n                // link: function(value) {\r\n                //   if (value) {\r\n                //     var href = prompt('请输入url');\r\n                //     this.quill.format(\"link\", href);\r\n                //   } else {\r\n                //     this.quill.format(\"link\", false);\r\n                //   }\r\n                // },\r\n                }\r\n            }\r\n            }\r\n        },\r\n        header: {\r\n            token: sessionStorage.token\r\n        } // 有的图片服务器要求请求头需要有token\r\n       }   \r\n    },\r\n    methods:{\r\n        handleSizeChange(val) {\r\n            this.size = val;\r\n            this.findMsg();\r\n            console.log(`每页 ${val} 条`);\r\n        },\r\n        handleCurrentChange(val) {\r\n            this.currentSize = val;\r\n            this.findMsg();\r\n            console.log(`当前页: ${val}`);\r\n        },\r\n        getNewsCount(){\r\n            getNewsCount().then(res=>{\r\n                this.total = res;\r\n                console.log(\"total\"+res);\r\n            })\r\n        },\r\n        findMsg(){\r\n            this.loading=true;\r\n            this.formdata.stpage = this.currentSize<=1?0:this.currentSize-1;\r\n            this.formdata.pagesize = this.size;\r\n            findNewsInfo(this.formdata).then(res=>{\r\n                this.tableData = res.data;\r\n                for(var k=0;k<this.tableData.length;k++){\r\n                    if(this.tableData[k].imgurl!=null){\r\n                        this.imgurlData[k] = this.tableData[k].imgurl.split(',');\r\n                    }else{\r\n                        this.imgurlData[k] = null;\r\n                    }\r\n                    \r\n                }\r\n                this.loading=false;\r\n                \r\n            }).catch(err => {\r\n                this.$message.error('服务器出错'+err);\r\n                this.loading=false;\r\n            })\r\n        },\r\n        newsSearch(){\r\n            this.loading=true;\r\n            this.searchform.searchvalue = this.searchinput;\r\n            getNewsSearch(this.searchform).then(res=>{\r\n                this.tableData = res.data;\r\n                this.total = this.tableData.length;\r\n                this.loading=false;\r\n            }).catch(err => {\r\n                this.$message.error('服务器出错');\r\n                this.loading=false;\r\n            })\r\n        },\r\n        handleClick(val){\r\n            console.log(val);\r\n            this.EditdialogFormVisible = true;\r\n            this.form = val;\r\n            this.content = this.form.newscontent;\r\n        },\r\n        deleteClick(uid,index){\r\n            this.loading=true;\r\n            this.delform.id = uid;\r\n            console.log(this.delform);\r\n            delNews(this.delform).then(res=>{\r\n                console.log(res);\r\n                if(res==1){\r\n                    this.tableData.splice(index,1);//删除掉tableData数组上的第index个元素\r\n                    this.getNewsCount();\r\n                    this.loading=false;\r\n                    this.$message.success(\"删除成功\");\r\n                    \r\n                }else{\r\n                    this.loading=false;\r\n                    this.$message.error(\"服务器繁忙,删除失败\");\r\n                }\r\n            }).catch(err => {\r\n                this.$message.error('服务器出错');\r\n                this.loading=false;\r\n            })\r\n            \r\n        },\r\n        updateData() {\r\n            this.$confirm('您确认修改信息了吗?', '提示', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n            type: 'warning',\r\n             \r\n            }).then(() => {\r\n                this.dialogFormVisible = true;\r\n                this.content = this.$refs.myQuillEditor.quill.root.innerHTML;\r\n                console.log(this.content);\r\n                this.$message({\r\n                    type: 'success',\r\n                    message: '删除成功!'\r\n                    \r\n                });\r\n                this.dialogFormVisible = false;\r\n            }).catch(() => {\r\n                \r\n                \r\n            });\r\n          },\r\n      lookClick(data){\r\n            console.log(data);\r\n            this.NewsdialogFormVisible = true;\r\n            this.form.newstitle = data.newstitle;\r\n            this.form.newstype = data.newstype;\r\n            this.form.publishdata = data.publishdata;\r\n            this.urlData = data.imgurl.split(',');\r\n            this.content = data.newscontent;\r\n            console.log(this.urlData.length+this.urlData[0]);\r\n        },\r\n    onEditorBlur() {\r\n      //失去焦点事件\r\n    },\r\n    onEditorFocus() {\r\n      //获得焦点事件\r\n    },\r\n    onEditorChange() {\r\n      //内容改变事件\r\n      this.$emit(\"input\", this.content);\r\n    },\r\n\r\n    // 富文本图片上传前\r\n    beforeUpload() {\r\n      // 显示loading动画\r\n      this.quillUpdateImg = true;\r\n    },\r\n    handleChange(response, file, fileList){\r\n        this.urlData.push(response.url);\r\n        console.log(response.url);\r\n    },\r\n    handleRemove(file,fileList){\r\n         this.urlData = [];\r\n         fileList.forEach(element => {\r\n           this.urlData.push(element.url);\r\n         });\r\n    },\r\n    uploadSuccess(res, file) {\r\n      // res为图片服务器返回的数据\r\n      // 获取富文本组件实例\r\n      console.log(file);\r\n      let quill = this.$refs.myQuillEditor.quill;\r\n      // 如果上传成功\r\n      if (res.code == 200) {\r\n        // 获取光标所在位置\r\n        let length = quill.getSelection().index;\r\n        // 插入图片  res.url为服务器返回的图片地址\r\n        quill.insertEmbed(length, \"image\", res.url);\r\n        // 调整光标到最后\r\n        quill.setSelection(length + 1);\r\n      } else {\r\n        this.$message.error(\"图片插入失败\");\r\n      }\r\n      // loading动画消失\r\n      this.quillUpdateImg = false;\r\n    },\r\n    // 富文本图片上传失败\r\n    uploadError() {\r\n      // loading动画消失\r\n      this.quillUpdateImg = false;\r\n      this.$message.error(\"图片插入失败\");\r\n    },\r\n    beforeAvatarUpload(file) {\r\n        const isJPG = file.type === 'image/jpeg';\r\n        const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n        if (!isJPG) {\r\n          this.$message.error('上传头像图片只能是 JPG 格式!');\r\n        }\r\n        if (!isLt2M) {\r\n          this.$message.error('上传头像图片大小不能超过 2MB!');\r\n        }\r\n        return isJPG && isLt2M;\r\n      },\r\n      handleExceed(files, fileList) {\r\n        this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);\r\n      },\r\n      //c\r\n      uploadFile(file){\r\n          this.formPicsData.append('file', file.file);\r\n      },\r\n      UploadSubmit(){\r\n        this.form.newscontent = this.$refs.myQuillEditor.quill.root.innerHTML;\r\n        this.fullscreenLoading = true;\r\n        this.formPicsData = new FormData();\r\n        this.$refs.upload.submit();// 这里是执行文件上传的函数，其实也就是获取我们要上传的文件\r\n        uploadImg(this.formPicsData).then(res => {\r\n          this.form.imgurl = res;\r\n          addNews(this.form).then(res=>{\r\n            console.log(res);\r\n            this.fullscreenLoading = false;\r\n            this.$message.success(\"成功上传\");\r\n          }).catch(res => {\r\n            this.fullscreenLoading = false;\r\n            this.$message.info(\"服务器繁忙,请稍后再试.\");\r\n          });\r\n        }).catch(res => {\r\n          this.fullscreenLoading = false;\r\n          this.$message.info(\"服务器繁忙,请稍后再试.\");\r\n        });\r\n     }\r\n    },\r\n        \r\n    created(){\r\n        this.getNewsCount();\r\n        this.findMsg();\r\n    },\r\n    watch:{\r\n        size(val,oldvalue){\r\n            console.log(val+\"  \"+oldvalue);\r\n        },\r\n        currentSize(){\r\n            console.log(\"000\");\r\n        },\r\n        select(val,oldvalue){\r\n            this.searchform.search = val;\r\n        },\r\n        $route(to,from){\r\n            console.log(to.path);\r\n            if(to.path=='/newsinfo'){\r\n                this.getNewsCount();\r\n                this.findMsg();\r\n            }\r\n        }\r\n    }\r\n}\r\n",{"version":3,"sources":["NewsInfo.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAsNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"NewsInfo.vue","sourceRoot":"src/components/admin","sourcesContent":["<template>\r\n    <div>\r\n        <el-container>\r\n                <el-header>\r\n                    <!-- 通过 slot 来指定在 input 中前置或者后置内容。 -->\r\n                    <el-input placeholder=\"请输入内容\" v-model=\"searchinput\" class=\"input-with-select\" style=\"margin-top:30px;height:20px\" >\r\n                         <el-select v-model=\"select\" slot=\"prepend\" placeholder=\"请选择\">\r\n                            <el-option label=\"新闻标题\" value=\"newstitle\"></el-option>\r\n                            <el-option label=\"新闻类别\" value=\"newstype\"></el-option>\r\n                            <el-option label=\"发布日期\" value=\"publishdate\"></el-option>\r\n                        </el-select>\r\n                        <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"newsSearch()\" ></el-button>\r\n                    </el-input>\r\n                </el-header>\r\n                <el-main>\r\n                    <el-table\r\n                        v-loading=\"loading\"\r\n                        :data=\"tableData\"\r\n                        border\r\n                        style=\"width: 100%\">\r\n                        <el-table-column\r\n                            fixed\r\n                            prop=\"uid\"\r\n                            label=\"新闻编号\"\r\n                            width=\"50\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                prop=\"newstitle\"\r\n                                label=\"新闻标题\"\r\n                                width=\"200\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                prop=\"newstype\"\r\n                                label=\"新闻种类\"\r\n                                width=\"100\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                label=\"新闻图片\"\r\n                                width=\"250\">\r\n                               <template slot-scope=\"scope\" >\r\n                                 <div v-if=\"imgurlData[scope.$index]!=null\">\r\n                                  <ul v-for=\"item,index in imgurlData[scope.$index]\"> \r\n                                      <img :src=\"require('../../assets/uploadimg/'+item)\" style=\"width:200px;height:100px\"/>\r\n                                  </ul>\r\n                                 </div>\r\n                                 <div v-else>无图片</div>\r\n                                </template>\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                prop=\"newscontent\"\r\n                                label=\"新闻内容\"\r\n                                width=\"780\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                prop=\"publishdate\"\r\n                                label=\"发布日期\"\r\n                                width=\"200\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                prop=\"clicknums\"\r\n                                label=\"浏览数\"\r\n                                width=\"100\">\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                                prop=\"commentstate\"\r\n                                label=\"是否有评论\"\r\n                                width=\"auto\">\r\n                        </el-table-column>  \r\n                        <el-table-column\r\n                                fixed=\"right\"\r\n                                label=\"操作\"\r\n                                width=\"250\">\r\n                        <template slot-scope=\"scope\">\r\n                            <el-button @click=\"lookClick(scope.row)\" type=\"success\" size=\"small\">查看</el-button>\r\n                            <!-- <el-button @click=\"handleClick(scope.row)\" type=\"primary\" size=\"small\">编辑</el-button> -->\r\n                            <el-button @click=\"deleteClick(scope.row.uid,scope.$index)\" type=\"danger\" size=\"small\">删除</el-button>\r\n                        </template>\r\n                    </el-table-column>\r\n                </el-table>\r\n                <!-- 分页代码以及逻辑-->\r\n                <div class=\"block\">\r\n                    <el-pagination\r\n                        @size-change=\"handleSizeChange\"\r\n                        @current-change=\"handleCurrentChange\"\r\n                        :current-page=\"currentSize\"\r\n                        :page-sizes=\"[10, 15, 20, 25]\"\r\n                        :page-size=\"size\"\r\n                        layout=\"total, sizes, prev, pager, next, jumper\"\r\n                        :total=\"total\">\r\n                    </el-pagination>\r\n                    <!-- <div>\r\n                        测试数值显示:<br>\r\n                        每页:{{size}}条<br>\r\n                        当前页:{{currentSize}}\r\n                    </div> -->\r\n                </div>\r\n                \r\n                </el-main>\r\n        </el-container>\r\n        <!-- 预览新闻弹窗 -->\r\n        <el-dialog \r\n          :visible.sync=\"NewsdialogFormVisible\" \r\n          fullscreen\r\n          class=\"dialog\"\r\n          >\r\n          <div class=\"ql-editor\">\r\n              <div class=\"dialogheader\">\r\n                    <div> <b>{{form.newstitle}}</b> </div>\r\n                    <div style=\"text-align:right;margin-top:20px;width:93%;font-size:10px\">\r\n                        <div>发布日期:{{form.publishdate}}&nbsp&nbsp类别:{{form.newstype}}</div>\r\n                    </div>\r\n              </div>\r\n              <div class=\"dialogimg\">\r\n                <div v-if=\"urlData.length==1\"  style=\"text-align:center\" >\r\n                    <img :src=\"require('../../assets/uploadimg/'+this.urlData[0])\" style=\"width:400px;height:300px;\"/>  \r\n                </div>\r\n                \r\n                <div v-else-if=\"urlData.length==2\" style=\"text-align:center\">\r\n                      <img :src=\"require('../../assets/uploadimg/'+this.urlData[0])\" style=\"width:400px;height:300px;\"/>\r\n                      <img :src=\"require('../../assets/uploadimg/'+this.urlData[1])\" style=\"margin-left:50px;width:400px;height:300px;\"/>   \r\n                </div>\r\n\r\n                <div v-else-if=\"urlData.length==3\" style=\"text-align:center\">\r\n                  <div><img :src=\"require('../../assets/uploadimg/'+this.urlData[0])\" style=\"width:480px;height:250px;\"/></div> \r\n                  <div style=\"margin-top:15px\">\r\n                    <img :src=\"require('../../assets/uploadimg/'+this.urlData[1])\" style=\"width:400px;height:250px;\"/> \r\n                    <img :src=\"require('../../assets/uploadimg/'+this.urlData[2])\" style=\"margin-left:50px;width:400px;height:250px;\"/> \r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"dialogcontent\">\r\n                  <div v-html=\"content\"></div>\r\n              </div>\r\n          </div>\r\n        </el-dialog>\r\n\r\n        <!-- 新闻编辑弹出框 -->\r\n        <el-dialog title=\"个人信息\" :visible.sync=\"EditdialogFormVisible\"  >\r\n            <el-container>\r\n            <el-header style=\"height:120px;margin-top:20px\">\r\n                <div>\r\n                 <el-form ref=\"form\" :model=\"form\" label-width=\"80px\">\r\n                    <el-form-item label=\"新闻标题\">\r\n                        <el-input v-model=\"form.newstitle\" maxlength=\"20\" > </el-input>\r\n                    </el-form-item>\r\n                     <el-form-item label=\"新闻类别\" >\r\n                         <el-select v-model=\"form.newstype\" placeholder=\"请选择类别\"  >\r\n                             <el-option label=\"本村动态\" value=\"本村动态\"></el-option>\r\n                             <el-option label=\"领导班子\" value=\"领导班子\"></el-option>\r\n                             <el-option label=\"党建园地\" value=\"党建园地\"></el-option>\r\n                             <el-option label=\"特色经济\" value=\"特色经济\"></el-option>\r\n                             <el-option label=\"民生工程\" value=\"民生工程\"></el-option>\r\n                             <el-option label=\"乡村文化\" value=\"乡村文化\"></el-option>\r\n                             <el-option label=\"村务公开\" value=\"村务公开\"></el-option>\r\n                             <el-option label=\"乡村荣誉\" value=\"乡村荣誉\"></el-option>\r\n                         </el-select>\r\n                    </el-form-item>\r\n                    <el-form-item label=\"发表时间\">\r\n                         <el-date-picker\r\n                            v-model=\"form.publishdate\"\r\n                            type=\"date\"\r\n                            placeholder=\"选择日期\"\r\n                            value-format=\" yyyy-MM-dd\"\r\n                            format=\"yyyy-MM-dd\">\r\n                         </el-date-picker>\r\n                    </el-form-item>\r\n                    \r\n                 </el-form>\r\n                </div>\r\n            </el-header>\r\n            <el-main>\r\n                <div class=\"container\" style=\"height:auto;\">\r\n                  <div>\r\n                      <el-upload\r\n                              class=\"avatar-uploader\"\r\n                              ref=\"upload\"\r\n                              action=\"/as\"\r\n                              :headers = \"headers\"\r\n                              :on-preview=\"handlePreview\"\r\n                              :on-remove=\"handleRemove\"\r\n                              :before-upload=\"beforeAvatarUpload\"\r\n                              :http-request=\"uploadFile\"\r\n                              :on-change=\"handleChange\"\r\n                              multiple\r\n                              :limit=\"3\"\r\n                              :file-list=\"fileList\"\r\n                              :on-exceed=\"handleExceed\"\r\n                              list-type=\"picture\"\r\n                              :auto-upload=\"false\">\r\n                              <el-button size=\"small\" type=\"primary\">选择图片</el-button>\r\n                              <div slot=\"tip\" class=\"el-upload__tip\">只能上传jpg文件，且不超过500kb,最多三张</div>\r\n                      </el-upload> \r\n                      <quill-editor \r\n                          style=\"line-height: normal !important;height: 590px;\"\r\n                          v-model=\"content\"\r\n                          ref=\"myQuillEditor\" \r\n                          :options=\"editorOption\" \r\n                          @blur=\"onEditorBlur($event)\" @focus=\"onEditorFocus($event)\"\r\n                          @change=\"onEditorChange($event)\">\r\n                      </quill-editor>   \r\n                  </div>\r\n                </div>     \r\n            </el-main>\r\n        </el-container>         \r\n            <div slot=\"footer\" class=\"dialog-footer\">\r\n                <el-button @click=\"EditdialogFormVisible = false\">取 消</el-button>\r\n                <el-button type=\"primary\" @click=\"updateData()\">修 改</el-button>             \r\n            </div>        \r\n        </el-dialog>   \r\n        \r\n    </div>\r\n</template>\r\n \r\n<script>\r\n// 工具栏配置\r\nconst toolbarOptions = [\r\n  [\"bold\", \"italic\", \"underline\", \"strike\"], // 加粗 斜体 下划线 删除线\r\n  [\"blockquote\", \"code-block\"], // 引用  代码块\r\n  [{ header: 1 }, { header: 2 }], // 1、2 级标题\r\n  [{ list: \"ordered\" }, { list: \"bullet\" }], // 有序、无序列表\r\n  [{ script: \"sub\" }, { script: \"super\" }], // 上标/下标\r\n  [{ indent: \"-1\" }, { indent: \"+1\" }], // 缩进\r\n  // [{'direction': 'rtl'}],                         // 文本方向\r\n  [{ size: [\"small\", false, \"large\", \"huge\"] }], // 字体大小\r\n  [{ header: [1, 2, 3, 4, 5, 6, false] }], // 标题\r\n  [{ color: [] }, { background: [] }], // 字体颜色、字体背景颜色\r\n  [{ font: [] }], // 字体种类\r\n  [{ align: [] }], // 对齐方式\r\n  [\"clean\"], // 清除文本格式\r\n  [\"link\", \"image\", \"video\"] // 链接、图片、视频\r\n];\r\nimport { quillEditor } from \"vue-quill-editor\";\r\nimport \"quill/dist/quill.core.css\";\r\nimport \"quill/dist/quill.snow.css\";\r\nimport \"quill/dist/quill.bubble.css\";\r\nimport {findNewsInfo,getNewsCount,getNewsSearch,delNews} from '../../api/index';\r\nexport default {\r\n    name:\"userinfo\",\r\n    data(){\r\n        return{\r\n            formdata:{\r\n               stpage:'',\r\n               pagesize:''     \r\n            },\r\n            searchform:{\r\n               search:'',\r\n               searchvalue:''     \r\n            },\r\n            delform:{\r\n                id:''\r\n            },\r\n            form:{\r\n                newstitle:'',\r\n                newstype:'',\r\n                publishdate:'',\r\n                newscontent:'',\r\n                imgurl:''\r\n            }, \r\n            searchinput: '',\r\n            select: '',\r\n            size:10,\r\n            currentSize:0,\r\n            total:0,\r\n            tableData:[],\r\n            loading:false,\r\n            NewsdialogFormVisible:false,\r\n            EditdialogFormVisible:false,\r\n            rowData:[],\r\n            formLabelWidth: '130px',\r\n            imgurlData:[[]],\r\n            content:'',\r\n            urlData:'',\r\n            fileList:[],\r\n            quillUpdateImg:false,\r\n            fullscreenLoading:false,\r\n            editorOption: {\r\n            placeholder: \"\",\r\n            theme: \"snow\", // or 'bubble'\r\n            placeholder: \"您想说点什么？\",\r\n            modules: {\r\n            toolbar: {\r\n                container: toolbarOptions,\r\n                // container: \"#toolbar\",\r\n                handlers: {\r\n                image: function(value) {\r\n                    if (value) {\r\n                    // 触发input框选择图片文件\r\n                    document.querySelector(\".avatar-uploader input\").click();\r\n                    } else {\r\n                    this.quill.format(\"image\", false);\r\n                    }\r\n                },\r\n                // link: function(value) {\r\n                //   if (value) {\r\n                //     var href = prompt('请输入url');\r\n                //     this.quill.format(\"link\", href);\r\n                //   } else {\r\n                //     this.quill.format(\"link\", false);\r\n                //   }\r\n                // },\r\n                }\r\n            }\r\n            }\r\n        },\r\n        header: {\r\n            token: sessionStorage.token\r\n        } // 有的图片服务器要求请求头需要有token\r\n       }   \r\n    },\r\n    methods:{\r\n        handleSizeChange(val) {\r\n            this.size = val;\r\n            this.findMsg();\r\n            console.log(`每页 ${val} 条`);\r\n        },\r\n        handleCurrentChange(val) {\r\n            this.currentSize = val;\r\n            this.findMsg();\r\n            console.log(`当前页: ${val}`);\r\n        },\r\n        getNewsCount(){\r\n            getNewsCount().then(res=>{\r\n                this.total = res;\r\n                console.log(\"total\"+res);\r\n            })\r\n        },\r\n        findMsg(){\r\n            this.loading=true;\r\n            this.formdata.stpage = this.currentSize<=1?0:this.currentSize-1;\r\n            this.formdata.pagesize = this.size;\r\n            findNewsInfo(this.formdata).then(res=>{\r\n                this.tableData = res.data;\r\n                for(var k=0;k<this.tableData.length;k++){\r\n                    if(this.tableData[k].imgurl!=null){\r\n                        this.imgurlData[k] = this.tableData[k].imgurl.split(',');\r\n                    }else{\r\n                        this.imgurlData[k] = null;\r\n                    }\r\n                    \r\n                }\r\n                this.loading=false;\r\n                \r\n            }).catch(err => {\r\n                this.$message.error('服务器出错'+err);\r\n                this.loading=false;\r\n            })\r\n        },\r\n        newsSearch(){\r\n            this.loading=true;\r\n            this.searchform.searchvalue = this.searchinput;\r\n            getNewsSearch(this.searchform).then(res=>{\r\n                this.tableData = res.data;\r\n                this.total = this.tableData.length;\r\n                this.loading=false;\r\n            }).catch(err => {\r\n                this.$message.error('服务器出错');\r\n                this.loading=false;\r\n            })\r\n        },\r\n        handleClick(val){\r\n            console.log(val);\r\n            this.EditdialogFormVisible = true;\r\n            this.form = val;\r\n            this.content = this.form.newscontent;\r\n        },\r\n        deleteClick(uid,index){\r\n            this.loading=true;\r\n            this.delform.id = uid;\r\n            console.log(this.delform);\r\n            delNews(this.delform).then(res=>{\r\n                console.log(res);\r\n                if(res==1){\r\n                    this.tableData.splice(index,1);//删除掉tableData数组上的第index个元素\r\n                    this.getNewsCount();\r\n                    this.loading=false;\r\n                    this.$message.success(\"删除成功\");\r\n                    \r\n                }else{\r\n                    this.loading=false;\r\n                    this.$message.error(\"服务器繁忙,删除失败\");\r\n                }\r\n            }).catch(err => {\r\n                this.$message.error('服务器出错');\r\n                this.loading=false;\r\n            })\r\n            \r\n        },\r\n        updateData() {\r\n            this.$confirm('您确认修改信息了吗?', '提示', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n            type: 'warning',\r\n             \r\n            }).then(() => {\r\n                this.dialogFormVisible = true;\r\n                this.content = this.$refs.myQuillEditor.quill.root.innerHTML;\r\n                console.log(this.content);\r\n                this.$message({\r\n                    type: 'success',\r\n                    message: '删除成功!'\r\n                    \r\n                });\r\n                this.dialogFormVisible = false;\r\n            }).catch(() => {\r\n                \r\n                \r\n            });\r\n          },\r\n      lookClick(data){\r\n            console.log(data);\r\n            this.NewsdialogFormVisible = true;\r\n            this.form.newstitle = data.newstitle;\r\n            this.form.newstype = data.newstype;\r\n            this.form.publishdata = data.publishdata;\r\n            this.urlData = data.imgurl.split(',');\r\n            this.content = data.newscontent;\r\n            console.log(this.urlData.length+this.urlData[0]);\r\n        },\r\n    onEditorBlur() {\r\n      //失去焦点事件\r\n    },\r\n    onEditorFocus() {\r\n      //获得焦点事件\r\n    },\r\n    onEditorChange() {\r\n      //内容改变事件\r\n      this.$emit(\"input\", this.content);\r\n    },\r\n\r\n    // 富文本图片上传前\r\n    beforeUpload() {\r\n      // 显示loading动画\r\n      this.quillUpdateImg = true;\r\n    },\r\n    handleChange(response, file, fileList){\r\n        this.urlData.push(response.url);\r\n        console.log(response.url);\r\n    },\r\n    handleRemove(file,fileList){\r\n         this.urlData = [];\r\n         fileList.forEach(element => {\r\n           this.urlData.push(element.url);\r\n         });\r\n    },\r\n    uploadSuccess(res, file) {\r\n      // res为图片服务器返回的数据\r\n      // 获取富文本组件实例\r\n      console.log(file);\r\n      let quill = this.$refs.myQuillEditor.quill;\r\n      // 如果上传成功\r\n      if (res.code == 200) {\r\n        // 获取光标所在位置\r\n        let length = quill.getSelection().index;\r\n        // 插入图片  res.url为服务器返回的图片地址\r\n        quill.insertEmbed(length, \"image\", res.url);\r\n        // 调整光标到最后\r\n        quill.setSelection(length + 1);\r\n      } else {\r\n        this.$message.error(\"图片插入失败\");\r\n      }\r\n      // loading动画消失\r\n      this.quillUpdateImg = false;\r\n    },\r\n    // 富文本图片上传失败\r\n    uploadError() {\r\n      // loading动画消失\r\n      this.quillUpdateImg = false;\r\n      this.$message.error(\"图片插入失败\");\r\n    },\r\n    beforeAvatarUpload(file) {\r\n        const isJPG = file.type === 'image/jpeg';\r\n        const isLt2M = file.size / 1024 / 1024 < 2;\r\n\r\n        if (!isJPG) {\r\n          this.$message.error('上传头像图片只能是 JPG 格式!');\r\n        }\r\n        if (!isLt2M) {\r\n          this.$message.error('上传头像图片大小不能超过 2MB!');\r\n        }\r\n        return isJPG && isLt2M;\r\n      },\r\n      handleExceed(files, fileList) {\r\n        this.$message.warning(`当前限制选择 3 个文件，本次选择了 ${files.length} 个文件，共选择了 ${files.length + fileList.length} 个文件`);\r\n      },\r\n      //c\r\n      uploadFile(file){\r\n          this.formPicsData.append('file', file.file);\r\n      },\r\n      UploadSubmit(){\r\n        this.form.newscontent = this.$refs.myQuillEditor.quill.root.innerHTML;\r\n        this.fullscreenLoading = true;\r\n        this.formPicsData = new FormData();\r\n        this.$refs.upload.submit();// 这里是执行文件上传的函数，其实也就是获取我们要上传的文件\r\n        uploadImg(this.formPicsData).then(res => {\r\n          this.form.imgurl = res;\r\n          addNews(this.form).then(res=>{\r\n            console.log(res);\r\n            this.fullscreenLoading = false;\r\n            this.$message.success(\"成功上传\");\r\n          }).catch(res => {\r\n            this.fullscreenLoading = false;\r\n            this.$message.info(\"服务器繁忙,请稍后再试.\");\r\n          });\r\n        }).catch(res => {\r\n          this.fullscreenLoading = false;\r\n          this.$message.info(\"服务器繁忙,请稍后再试.\");\r\n        });\r\n     }\r\n    },\r\n        \r\n    created(){\r\n        this.getNewsCount();\r\n        this.findMsg();\r\n    },\r\n    watch:{\r\n        size(val,oldvalue){\r\n            console.log(val+\"  \"+oldvalue);\r\n        },\r\n        currentSize(){\r\n            console.log(\"000\");\r\n        },\r\n        select(val,oldvalue){\r\n            this.searchform.search = val;\r\n        },\r\n        $route(to,from){\r\n            console.log(to.path);\r\n            if(to.path=='/newsinfo'){\r\n                this.getNewsCount();\r\n                this.findMsg();\r\n            }\r\n        }\r\n    }\r\n}\r\n</script>\r\n<style>\r\n.input-with-select{\r\n    width: 500px;\r\n    height: 33px;\r\n}\r\n.el-select .el-input {\r\n    width: 100px;\r\n    height: 30px;\r\n}\r\n.input-with-select .el-input-group__prepend {\r\n    background-color: #fff;\r\n}\r\n.editor {\r\n  line-height: normal !important;\r\n  height: 590px;   \r\n  \r\n}\r\n.editor-btn{\r\n    width: 10%;\r\n    margin-top: 10px;\r\n    height:50px;\r\n}\r\n.content{\r\n  line-height: normal !important; \r\n  width:100%;\r\n}\r\n.dialog{\r\n  padding-left:150px;\r\n  padding-right:150px;\r\n  padding-top:30px;\r\n  padding-bottom: 30px;\r\n}\r\n.dialogheader{\r\n  width:80%;\r\n  margin-left: 10%;\r\n  margin-top: -20px;\r\n  font-size: 35px;\r\n  text-align: center;\r\n}\r\n.dialogimg{\r\n  margin-top: 30px;\r\n  width:100%;\r\n}\r\n \r\n.dialogcontent{\r\n  margin-top: 50px;\r\n  width:70%;\r\n  margin-left: 15%;\r\n}\r\n.ql-editor{\r\n   height: 550px;   \r\n}\r\n.ql-container.ql-snow{\r\n  height: 550px;\r\n}\r\n.el-select .el-input__inner {\r\n  width: 220px;\r\n}\r\n.ql-snow .ql-tooltip[data-mode=link]::before {\r\n  content: \"请输入链接地址:\";\r\n}\r\n.ql-snow .ql-tooltip.ql-editing a.ql-action::after {\r\n    border-right: 0px;\r\n    content: '保存';\r\n    padding-right: 0px;\r\n}\r\n\r\n.ql-snow .ql-tooltip[data-mode=video]::before {\r\n    content: \"请输入视频地址:\";\r\n}\r\n\r\n.ql-snow .ql-picker.ql-size .ql-picker-label::before,\r\n.ql-snow .ql-picker.ql-size .ql-picker-item::before {\r\n  content: '14px';\r\n}\r\n.ql-snow .ql-picker.ql-size .ql-picker-label[data-value=small]::before,\r\n.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=small]::before {\r\n  content: '10px';\r\n}\r\n.ql-snow .ql-picker.ql-size .ql-picker-label[data-value=large]::before,\r\n.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=large]::before {\r\n  content: '18px';\r\n}\r\n.ql-snow .ql-picker.ql-size .ql-picker-label[data-value=huge]::before,\r\n.ql-snow .ql-picker.ql-size .ql-picker-item[data-value=huge]::before {\r\n  content: '32px';\r\n}\r\n\r\n.ql-snow .ql-picker.ql-header .ql-picker-label::before,\r\n.ql-snow .ql-picker.ql-header .ql-picker-item::before {\r\n  content: '文本';\r\n}\r\n.ql-snow .ql-picker.ql-header .ql-picker-label[data-value=\"1\"]::before,\r\n.ql-snow .ql-picker.ql-header .ql-picker-item[data-value=\"1\"]::before {\r\n  content: '标题1';\r\n}\r\n.ql-snow .ql-picker.ql-header .ql-picker-label[data-value=\"2\"]::before,\r\n.ql-snow .ql-picker.ql-header .ql-picker-item[data-value=\"2\"]::before {\r\n  content: '标题2';\r\n}\r\n.ql-snow .ql-picker.ql-header .ql-picker-label[data-value=\"3\"]::before,\r\n.ql-snow .ql-picker.ql-header .ql-picker-item[data-value=\"3\"]::before {\r\n  content: '标题3';\r\n}\r\n.ql-snow .ql-picker.ql-header .ql-picker-label[data-value=\"4\"]::before,\r\n.ql-snow .ql-picker.ql-header .ql-picker-item[data-value=\"4\"]::before {\r\n  content: '标题4';\r\n}\r\n.ql-snow .ql-picker.ql-header .ql-picker-label[data-value=\"5\"]::before,\r\n.ql-snow .ql-picker.ql-header .ql-picker-item[data-value=\"5\"]::before {\r\n  content: '标题5';\r\n}\r\n.ql-snow .ql-picker.ql-header .ql-picker-label[data-value=\"6\"]::before,\r\n.ql-snow .ql-picker.ql-header .ql-picker-item[data-value=\"6\"]::before {\r\n  content: '标题6';\r\n}\r\n\r\n.ql-snow .ql-picker.ql-font .ql-picker-label::before,\r\n.ql-snow .ql-picker.ql-font .ql-picker-item::before {\r\n  content: '标准字体';\r\n}\r\n.ql-snow .ql-picker.ql-font .ql-picker-label[data-value=serif]::before,\r\n.ql-snow .ql-picker.ql-font .ql-picker-item[data-value=serif]::before {\r\n  content: '衬线字体';\r\n}\r\n.ql-snow .ql-picker.ql-font .ql-picker-label[data-value=monospace]::before,\r\n.ql-snow .ql-picker.ql-font .ql-picker-item[data-value=monospace]::before {\r\n  content: '等宽字体';\r\n}\r\n</style>"]}]}